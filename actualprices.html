<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Price Change | Kopala FPL</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#37003c">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kopala FPL">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="nav.css">
    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <style>

  
        :root {
            --fpl-purple: #37003c;
            --fpl-cyan: #00ffdf; /* Match your image color */
            --fpl-green: #00ff85;
            --fpl-pink: #ff005a;
        }
        body { font-family: 'Inter', sans-serif; background-color: #fff; margin: 0; padding: 10px; }
        
        /* The Date Banner */
        .date-banner {
            background: var(--fpl-cyan);
            color: #000;
            text-align: center;
            padding: 12px;
            font-weight: 900;
            font-size: 1.2rem;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        /* Two-Column Grid */
        .change-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px;
            background-color: #eee; /* Thin divider line */
            border: 1px solid #eee;
        }

        .column { background: #fff; }

        /* Table Styling */
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { text-align: left; padding: 10px; color: #666; font-weight: 700; border-bottom: 1px solid #f0f0f0; }
        td { padding: 12px 10px; font-weight: 700; }
        
        .center { text-align: center; }
        .empty-msg { padding: 20px; font-weight: 800; color: #000; font-size: 1rem; }

        /* Icon Styling */
        .icon-up { color: var(--fpl-green); margin-right: 8px; font-size: 1.1rem; }
        .icon-down { color: var(--fpl-pink); margin-right: 8px; font-size: 1.1rem; }
    </style>
</head>
    <div id="nav-placeholder"></div>
<body>

<div id="price-changes-container">
    </div>

<script>
    const PROXY = "/.netlify/functions/fpl-proxy?endpoint=bootstrap-static/";
    let teamMap = {};

    async function init() {
        try {
            const res = await fetch(PROXY);
            const data = await res.json();
            
            data.teams.forEach(t => teamMap[t.id] = t.short_name);

            // Filter for players with price changes in the current 24h event
            const movers = data.elements
                .filter(p => p.cost_change_event !== 0)
                .map(p => ({
                    name: p.web_name,
                    team: teamMap[p.team],
                    cost: (p.now_cost / 10).toFixed(1),
                    dir: p.cost_change_event > 0 ? 'up' : 'down'
                }));

            renderUI(movers);
        } catch (e) { console.error("Error loading data", e); }
    }

    function renderUI(movers) {
        const container = document.getElementById('price-changes-container');
        const today = new Date().toLocaleDateString('en-GB', { 
            weekday: 'short', day: 'numeric', month: 'long', year: 'numeric' 
        });

        const risers = movers.filter(m => m.dir === 'up');
        const fallers = movers.filter(m => m.dir === 'down');

        let html = `
            <div class="date-banner">${today}</div>
            <div class="change-grid">
                <div class="column">
                    <table>
                        <thead><tr><th>Name</th><th>Team</th><th class="center">Cost</th></tr></thead>
                        <tbody>
                            ${risers.length > 0 ? risers.map(p => `
                                <tr>
                                    <td><i class="fa-solid fa-circle-up icon-up"></i>${p.name}</td>
                                    <td>${p.team}</td>
                                    <td class="center">${p.cost}</td>
                                </tr>`).join('') : '<tr><td colspan="3" class="empty-msg">No price rises</td></tr>'}
                        </tbody>
                    </table>
                </div>

                <div class="column">
                    <table>
                        <thead><tr><th>Name</th><th>Team</th><th class="center">Cost</th></tr></thead>
                        <tbody>
                            ${fallers.length > 0 ? fallers.map(p => `
                                <tr>
                                    <td><i class="fa-solid fa-circle-down icon-down"></i>${p.name}</td>
                                    <td>${p.team}</td>
                                    <td class="center">${p.cost}</td>
                                </tr>`).join('') : '<tr><td colspan="3" class="empty-msg">No price falls</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>`;

        container.innerHTML = html;
    }

    init();
</script>



<script src="nav.js"></script>
<div id="footer-placeholder"></div>
<script src="footer.js"></script>
</body>
</html>
