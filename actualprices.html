<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Price Change | Kopala FPL</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#37003c">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kopala FPL">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="nav.css">
    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">


    <style>
        :root {
            --fpl-cyan: #00ffdf;
            --fpl-green: #00ff85;
            --fpl-pink: #ff005a;
        }
        body { font-family: 'Inter', sans-serif; background-color: #fff; margin: 0; padding: 20px; color: #000; }

        /* Search & Filter Bar Styling */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; max-width: 800px; margin-left: auto; margin-right: auto; }
        .controls input, .controls select { 
            padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 0.9rem;
        }
        .search-box { flex: 2; }
        .filter-box { flex: 1; }

        /* The Date Banner */
        .date-banner {
            background: var(--fpl-cyan);
            color: #000;
            text-align: center;
            padding: 15px;
            font-weight: 900;
            font-size: 1.4rem;
            border-radius: 4px;
            margin-bottom: 2px;
            text-transform: none;
        }

        /* Two-Column Grid */
        .change-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px;
            background-color: #f0f0f0; /* The thin middle line */
            border: 1px solid #f0f0f0;
            max-width: 1000px;
            margin: 0 auto;
        }

        .column { background: #fff; min-height: 100px; }

        /* Table Design */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px 10px; color: #333; font-weight: 700; font-size: 0.85rem; border-bottom: 1px solid #eee; }
        td { padding: 12px 10px; font-weight: 700; font-size: 0.95rem; vertical-align: middle; }
        
        .center { text-align: right; padding-right: 20px; }
        .empty-msg { padding: 30px 10px; font-weight: 800; font-size: 1.1rem; color: #000; }

        /* Arrow Icons */
        .icon-up { color: var(--fpl-green); background: #00ff8522; border-radius: 50%; padding: 4px; margin-right: 10px; font-size: 0.8rem; }
        .icon-down { color: var(--fpl-pink); background: #ff005a22; border-radius: 50%; padding: 4px; margin-right: 10px; font-size: 0.8rem; }
        
        @media (max-width: 600px) {
            .change-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="controls">
    <input type="text" id="mainSearch" class="search-box" placeholder="Search Player Name..." onkeyup="init()">
    <select id="teamFilter" class="filter-box" onchange="init()">
        <option value="all">All Teams</option>
    </select>
</div>
<div id="nav-placeholder"></div>
<div id="price-changes-container">
    </div>

<script>
    const PROXY = "/.netlify/functions/fpl-proxy?endpoint=bootstrap-static/";
    let teamMap = {};

    async function init() {
        try {
            const res = await fetch(PROXY);
            const data = await res.json();
            
            // Map Team Names and populate dropdown once
            const teamSelect = document.getElementById('teamFilter');
            if (teamSelect.options.length === 1) {
                data.teams.sort((a,b) => a.name.localeCompare(b.name)).forEach(t => {
                    teamMap[t.id] = t.short_name;
                    let opt = document.createElement('option');
                    opt.value = t.id; opt.innerText = t.name;
                    teamSelect.appendChild(opt);
                });
            }

            const searchVal = document.getElementById('mainSearch').value.toLowerCase();
            const teamVal = document.getElementById('teamFilter').value;

            // Filter logic: Only current day's changes + search/team filters
            const movers = data.elements
                .filter(p => p.cost_change_event !== 0)
                .filter(p => p.web_name.toLowerCase().includes(searchVal))
                .filter(p => teamVal === 'all' || String(p.team) === teamVal)
                .map(p => ({
                    name: p.web_name,
                    team: teamMap[p.team],
                    cost: (p.now_cost / 10).toFixed(1),
                    dir: p.cost_change_event > 0 ? 'up' : 'down'
                }));

            renderUI(movers);
        } catch (e) { console.error("API Error", e); }
    }

    function renderUI(movers) {
        const container = document.getElementById('price-changes-container');
        
        // Format date like: "Fri, 13 February 2026"
        const options = { weekday: 'short', day: 'numeric', month: 'long', year: 'numeric' };
        const today = new Date().toLocaleDateString('en-GB', options);

        const risers = movers.filter(m => m.dir === 'up');
        const fallers = movers.filter(m => m.dir === 'down');

        container.innerHTML = `
            <div class="date-banner">${today}</div>
            <div class="change-grid">
                <div class="column">
                    <table>
                        <thead><tr><th style="width:50%">Name</th><th>Team</th><th class="center">Cost</th></tr></thead>
                        <tbody>
                            ${risers.length > 0 ? risers.map(p => `
                                <tr>
                                    <td><i class="fa-solid fa-chevron-up icon-up"></i>${p.name}</td>
                                    <td>${p.team}</td>
                                    <td class="center">${p.cost}</td>
                                </tr>`).join('') : '<tr><td colspan="3" class="empty-msg">No price rises</td></tr>'}
                        </tbody>
                    </table>
                </div>

                <div class="column">
                    <table>
                        <thead><tr><th style="width:50%">Name</th><th>Team</th><th class="center">Cost</th></tr></thead>
                        <tbody>
                            ${fallers.length > 0 ? fallers.map(p => `
                                <tr>
                                    <td><i class="fa-solid fa-chevron-down icon-down"></i>${p.name}</td>
                                    <td>${p.team}</td>
                                    <td class="center">${p.cost}</td>
                                </tr>`).join('') : '<tr><td colspan="3" class="empty-msg">No price falls</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>`;
    }

    init();
</script>



<script src="nav.js"></script>
<div id="footer-placeholder"></div>
<script src="footer.js"></script>
</body>
</html>
